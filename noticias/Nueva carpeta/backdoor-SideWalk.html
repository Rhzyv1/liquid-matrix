<!DOCTYPE html>
<html>
<head>
		<title>Backdoor SideWalk</title>
	<link rel="stylesheet" type="text/css" href="css.css">
	<!---logo---->
	<link rel="icon"  href="../img/nun.png">
<!---Iconos---->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<!---animations---->
	<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	
		<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Stick+No+Bills&display=swap" rel="stylesheet">
		<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Stick+No+Bills&display=swap" rel="stylesheet">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Carter+One&family=Poor+Story&display=swap" rel="stylesheet">	


	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Stick+No+Bills&display=swap" rel="stylesheet">


	</head>
<body>
	<header class="haeder9">

<div class="top">
	<h4><i class="fa fa-"></i>@ Last News</h4>
	<div class="social">
		<a href="https://www.facebook.com/liquidmatrixdigest/"><i class="fa fa-facebook"></i></a>
		
		<a href="https://twitter.com/liquidmatrix"><i class="fa fa-twitter"></i></a>

		<a href="https://www.youtube.com/channel/UCFfZEfQF0T4O_6t6YoHGW4w"> <i class="fa fa-youtube"></i> </a>

	</div>
	
</div>

			<div class="cabezera">
		<img src="../img/bannerlogo-6.png">
			</div>	

<section class="noticia">
	

<h4> Análisis de la variante para Linux del backdoor SideWalk
</h4>
<p>El equipo de investigación de ESET descubrió otra herramienta del ya extenso arsenal de herramientas que utiliza el grupo de APT SparklingGoblin: una variante para Linux del backdoor SideWalk.</p>
<p>Vladislav Hrčka   <time datetime="08-10-2022"> </time>28-01-2023</h6>
</p>
</section>



</header>

<nav class="bon-fl">
<a href="https://www.facebook.com/liquidmatrixdigest/"><i class="fa fa-facebook"></i></a>
		
		<a href="https://twitter.com/liquidmatrix"><i class="fa fa-twitter"></i></a>

		<a href="https://www.youtube.com/channel/UCFfZEfQF0T4O_6t6YoHGW4w"> <i class="fa fa-youtube"></i> </a></nav>


<article class="nota">

<P>El equipo de investigación de ESET ha descubierto una variante para Linux del backdoor SideWalk, uno de los múltiples implantes personalizados que utiliza el grupo de APT SparklingGoblin. Esta variante se utilizó en un ataque contra una universidad de Hong Kong en febrero de 2021, la misma universidad que ya había sido atacada por SparklingGoblin durante las protestas estudiantiles de mayo de 2020. Originalmente llamamos a este backdoor StageClient, pero ahora nos referimos a el como SideWalk Linux. También descubrimos que un backdoor para Linux previamente conocido, Spectre RAT, documentado por primera vez por 360 Netlab, también es una variante de SideWalk Linux, ya que presenta múltiples puntos en común con las muestras que identificamos.</P>
<p>
SparklingGoblin es un grupo APT cuyas tácticas, técnicas y procedimientos (TTP, por sus siglas en inglés) se superponen parcialmente con APT41 y BARIUM. Utiliza loaders basados ​​en Motnug y ChaCha20, los backdoors CROSSWALK y SideWalk, junto con Korplug (también conocido como PlugX) y Cobalt Strike. Si bien el grupo se enfoca principalmente en el este y sudeste de Asia, también hemos visto ataques de SparklingGoblin apuntando a una amplia gama de organizaciones de distintos sectores en todo el mundo, con un enfoque particular en el sector académico. SparklingGoblin es uno de los grupos con acceso al backdoor ShadowPad.
</p>
<p>
Esta publicación documenta SideWalk Linux, su victimología y sus numerosas similitudes con el backdoor SideWalk originalmente descubierto.
</p>
<h4>Atribución</h4>
<p>
El backdoor SideWalk es exclusivo del grupo de APT SparklingGoblin. Además de las múltiples similitudes de código entre las variantes para Linux de SideWalk y varias herramientas de SparklingGoblin, una de las muestras de SideWalk Linux usa una dirección C&C (66.42.103[.]222) que el grupo utilizó anteriormente.
</p>
<p>Teniendo en cuenta todos estos factores, atribuimos con gran confianza SideWalk Linux al grupo de APT SparklingGoblin.
</p>

<h4>Victimología</h4>
<p>
Si bien en VirusTotal hay varias muestras de SideWalk Linux, tal como las conocemos ahora, en nuestra telemetría hemos encontrado solo una víctima comprometida con esta variante de SideWalk: una universidad de Hong Kong que, en medio de protestas estudiantiles, había sido atacada previamente por SparklingGoblin (usando el loader Motnug y el backdoor CROSSWALK) y Fishmonger (usando los backdoor ShadowPad y Spyder). Tenga en cuenta que en ese momento pusimos esa actividad bajo la denominación más amplia de Winnti Group.
</p>
<p>
SparklingGoblin comprometió por primera vez a esta universidad en particular en mayo de 2020, y detectamos por primera vez la variante para Linux de SideWalk en la red de esa universidad en febrero de 2021. El grupo atacó continuamente a esta organización durante un largo período de tiempo, comprometiendo con éxito varios servidores clave, incluido un servidor de impresión, un servidor de correo electrónico y un servidor utilizado para administrar los horarios de los estudiantes y las inscripciones en los cursos.
</p>
<h4>El camino hacia Sidewalk Linux</h4>
<p>
SideWalk, un backdoor que describimos por primera en su versión para Windows en agosto de 2021, es una herramienta multipropósito que permite cargar módulos adicionales enviados desde el servidor de C&C. Hace uso de Google Docs como dead-drop resolver, y de Cloudflare como su servidor de C&C. Es capaz de manejar adecuadamente la comunicación detrás de un proxy.
</p>
<p>
Actualmente se desconoce la cadena de compromiso, pero creemos que el vector de ataque inicial podría haber sido la explotación de una vulnerabilidad. Esta hipótesis se basa en el artículo de 360 ​​Netlab que describe la botnet Spectre apuntando a cámaras IP y dispositivos NVR y DVR, y el hecho de que la víctima de Hong Kong usó un servidor de WordPress vulnerable, ya que hubo muchos intentos de instalar varios webshells.
</p>
<p>

Documentamos por primera vez la variante para Linux de SideWalk como StageClient el 2 de julio de 2021 , sin establecer la conexión en ese momento con SparklingGoblin y su backdoor personalizado SideWalk. El nombre original se utilizó debido a las repetidas apariciones de la string StageClient en el código.
</p>

<p>Mientras investigamos más a fondo StageClient, nos encontramos con una publicación de 360 Netlab sobre la botnet Spectre. Esa publicación describe un backdoor modular para Linux con una configuración flexible que utiliza una variante del algoritmo de cifrado ChaCha20, básicamente un subconjunto de la funcionalidad de StageClient. Una inspección posterior confirmó esta hipótesis; además, encontramos una gran superposición en la funcionalidad, la infraestructura y los símbolos presentes en todos los binarios.
</p>
<h4>Comparamos la muestra de StageClient
</h4>
<p>
	E5E6E100876E652189E7D25FFCF06DE959093433 con las muestras de Spectre 7DF0BE2774B17F672B96860D013A933E97862E6C y encontramos numerosas similitudes, algunas de las cuales enumeramos a continuación.
</p>
<p>
Primero, hay una superposición en los comandos de C&C. Segundo, las muestras tienen la misma estructura de configuración y método de cifrado,
</p>

<img src="../img/Figure-1.-StageClient’s-configuration-with-modified-symbols-768x605.png">

<p>Además, los módulos de las muestras son administrados casi de la misma manera y la mayoría de las interfaces son idénticas; los módulos de StageClient solo necesitan implementar un handler adicional, que es para cerrar el módulo. Tres de los cinco módulos conocidos son casi idénticos.
</p>
<img src="../img/Figure-2.-Specter’s-configuration-with-modified-symbols-768x491.png">


<p>
Por último, pudimos ver sorprendentes superposiciones en los protocolos de red de las muestras comparadas. Una variante de ChaCha20 es utilizada dos veces para el cifrado con compresión LZ4 de la misma manera. Tanto StageClient como Spectre crean varios hilos (consulte la Figura 3 y la Figura 4) para administrar el envío y la recepción de mensajes asincrónicos junto con los latidos del corazón.</p>


<img src="../img/Figure-4.-A-part-of-Specter’s-StartNetwork-function-768x166.png">

<p>A pesar de todas estas sorprendentes similitudes, hay varios cambios. Los más destacables son los siguientes:
</p>
<ul>
<li>Los autores cambiaron del lenguaje C a C++. Se desconoce el motivo, pero debería ser más fácil implementar una arquitectura modular de este tipo en C++ debido a su compatibilidad con polimorfismos.</li>
<li>
Se agregó una opción para intercambiar mensajes a través de HTTP (consulte la Figura 5 y la Figura 6).</li>

<li>
Los plugins descargables fueron reemplazados por módulos precompilados que cumplen el mismo propósito; se agregaron varios comandos nuevos y dos módulos nuevos.</li>

</ul>

<p>Se agregó el módulo TaskSchedulerMod, que funciona como una utilidad cron integrada. Su tabla cron se almacena en la memoria; los trabajos se reciben a través de la red y se ejecutan como comandos de shell.
Se agregó el módulo SysInfoMgr, que proporciona información sobre el sistema subyacente, como la lista de paquetes instalados y detalles del hardware.
</p>
<p>
Estas similitudes nos convencen de que Spectre y StageClient pertenecen a la misma familia de malware. Sin embargo, considerando las numerosas superposiciones de código entre la variante de StageClient utilizada contra la universidad de Hong Kong en febrero de 2021 y SideWalk para Windows, como se describe en la siguiente sección, ahora creemos que Spectre y StageClient son variantes de Linux de SideWalk, por lo que hemos decidido referirnos a ellos como SideWalk Linux.
</p>
<p>
Similitudes con la variante de Windows
SideWalk Windows y SideWalk Linux comparten demasiadas similitudes para describirlas dentro de los límites de esta publicación de blog, por lo que aquí solo cubrimos las más llamativas.
</p>

<p>
Una similitud obvia se nota en las implementaciones del cifrado ChaCha20: ambas variantes usan un contador con un valor inicial de 0x0B, el cual se mencionó en nuestra anterior publicación como una especificidad de la implementación ChaCha20 de SideWalk.
</p>
<h4>
Arquitectura de software
</h4>
<p>
Una particularidad de SideWalk es el uso de múltiples subprocesos para ejecutar una tarea específica. Notamos que en ambas variantes hay exactamente cinco hilos ejecutados simultáneamente, cada uno de ellos con una tarea específica. 
</p>

<ul>
<li>StageClient::ThreadNetworkReverse

Si aún no se ha establecido una conexión con el servidor de C&C, este subproceso intenta recuperar periódicamente la configuración del proxy local y la ubicación del servidor de C&C del dead-drop resolver. Si el paso anterior fue exitoso, intenta iniciar una 
conexión con el servidor C&C.
</li>

 <li>Si el backdoor no recibe un comando en la cantidad de tiempo especificada, este hilo puede terminar la conexión con el servidor C&C o cambiar a un modo de “suspensión” que introduce cambios menores en el comportamiento.</li>

<li>
StageClient::ThreadPollingDriven
<br>
Si no hay otros datos en cola para enviar, este subproceso envía periódicamente un comando de latido al servidor C&C que además puede contener la hora actual.</li>
</ul>
<h4>
StageClient::ThreadBizMsgSend.
</h4>

<ul>
<li>Este hilo comprueba periódicamente si hay datos para enviar en las cola de mensajes utilizada por todos los demás hilos y, si es así, los procesa.
</li>

<li>
StageClient::ThreadBizMsgHandler
Este hilo comprueba periódicamente si hay mensajes pendientes recibidos del servidor de C&C y, en caso afirmativo, los gestiona. </li>

</ul>

<h4>
Suma de verificación
</h4>

<p>Primero, antes de descifrar, se verifica la integridad de los datos. Esta verificación es similar en ambas implementaciones de SideWalk  se computa un hash MD5 en el nonce de ChaCha20 concatenado con los datos de configuración cifrados. Este hash luego se compara con un valor predefinido y, si no es igual, SideWalk sale.</p>


<h4>Protocolo de comunicación</h4>
<h3>Serialización de datos</h3>
<p>
El protocolo de comunicación entre la máquina infectada y el C&C es HTTP o HTTPS, según la configuración, pero en ambos casos los datos se serializan de la misma manera. No solo la implementación es muy similar, sino que se usa la misma clave de cifrado en ambas implementaciones, lo que acentúa la similitud entre las dos variantes.
</p>
<h4>
Solicitudes POST</h4>
<p>
En las solicitudes POST utilizadas por SideWalk para obtener comandos y payloads del servidor de C&C, un punto destacable es el uso de los dos parámetros gtsid y gtuvid, como se ve en la Figura 13. En la variante para Linux se usan parámetros idénticos.
</p>
<div class="cuadro">

<p>POST /M26RcKtVr5WniDVZ/5CDpKo5zmAYbTmFl HTTP/1.1</p>
<p>Cache-Control: no-cache</p>
<p>Connection: close</p>
<p>Pragma: no-cache</p>
<p>User-Agent: Mozilla/5.0 Chrome/72.0.3626.109 </p>
<p>Safari/537.36</p>
<p>

gtsid: zn3isN2C6bWsqYvO</p>
<p>
gtuvid: 7651E459979F931D39EDC12D68384C2</p>
<p>1249A8DE265F3A925F6E289A2467BC47D</p>
<p>
Content-Length: 120</p>
<p>Host: update.facebookint.workers[.]dev</p>
</div>



<p>Otro punto interesante es que la variante para Windows se ejecuta como shellcode totalmente independiente de la posición, mientras que la variante de Linux es una biblioteca compartida. Sin embargo, creemos que los autores del malware podrían haber dado un paso más, usando una herramienta como sRDI para convertir un PE compilado de SideWalk en shellcode en lugar de escribirlo manualmente.</p>

<h4>Comandos</h4>
<p>Solo cuatro comandos no se implementan o se implementan de manera diferente en la variante para Linux, como se muestra en la Tabla 1. Todos los demás comandos están presentes, incluso con las mismas ID.
</p>


<table class="table" cellspacing="0" cellpadding="0">
	<tr>
		<th>Command ID (from C&C)</th>
		
		<th>Windows variants</th>
		<th>	Linux variants</th>

	</tr>
	<tr>
		<td>0x7C</td>
		<td>	Load a plugin sent by the C&C server.</td>
		<td>Write the received data to the file located at %AllUsersProfile%\UTXP\nat\, where is a hash of the value returned by VirtualAlloc at each execution of the malware</td>

	</tr>
	<tr>
		<td>0x82</td>
		<td>Collect domain information about running processes, and owners (owner SID, account name, process name, domain information).</td>
		<td>Do nothing.</td>

	</tr>
	<tr>
		<td>0x8C</td>
		<td>Data serialization function.</td>
		<td>Commands that are not handled, but fall in the default case, which is broadcasting a message to all the loaded module</td>

	</tr>
	<tr>
		<td>0x8E</td>
		<td>Write the received data to the file located at %AllUsersProfile%\UTXP\nat\, where is a hash of the value returned by VirtualAlloc at each execution of the malware</td>
		<td></td>

	</tr>
</table>


<h4>Versionado</h4>
<p>En la variante de Linux, observamos una especificidad que no se encontró en la variante de Windows</p>

<img id="grande" src="../img/Figure-14.-Versioning-function-in-SideWalk-Linux-768x749.png">


<h4>Plugins</h4>
<p>
En las variantes de SideWalk Linux los módulos están integrados; no se pueden obtener desde el servidor de C&C. Esa es una diferencia notable de la variante de Windows. Algunas de esas funcionalidades integradas, como la recopilación de información del sistema (SysInfoMgr, por ejemplo), como la configuración de la red, se realizan directamente mediante funciones dedicadas en la variante de Windows. En la variante de Windows, se pueden agregar algunos plugins a través de la comunicación con el C&C.
</p>

<img src="../img/Figure-10a.-ChaCha20-decryption-call-in-SideWalk-Windows-left-and-in-SideWalk-Linux-right-300x109.png">
<h4>
Evasión de defensa</h4>

<p>La variante para Windows de SideWalk hace todo lo posible para ocultar el objetivo de su código. Recortó todos los datos y códigos que no eran necesarios para su ejecución y cifró el resto. Por otro lado, las variantes para Linux contienen símbolos y dejan algunas claves de autenticación únicas y otros artefactos sin cifrar, lo que facilita significativamente la detección y el análisis.
<p>
	<P>
Además, el mayor número de funciones integradas en la variante de Windows sugiere que su código se compiló con un mayor nivel de optimización del compilador.
</P>

<h4>Conclusión</h4>
<p class="fondo">
El backdoor que se usó para atacar una universidad de Hong Kong en febrero de 2021 es de la misma familia que el backdoor SideWalk y, en realidad, es una variante para Linux del backdoor. Esta versión para Linux exhibe varias similitudes con su contraparte para Windows junto con varias novedades

</p>


<h3>Fuente:</h3>
<a href="https://www.welivesecurity.com/la-es/2022/09/14/analisis-variante-linux-backdoor-sidewalk/">
	https://www.welivesecurity.com/la-es/2022/09/14/analisis-variante-linux-backdoor-sidewalk/
</a>
<!----comentario esperar fase 2
<h6>
Tu opinión nos importa, ¡déjanos un comentario! </h6>
<textarea name="mesaje" placeholder="Si te fue útil esta información dejanos tu opinión.">
</textarea>
<div class="button">
	
<input type="button" value="Enviar">
<i class="fa fa-arrow-right">
</i>
</div>
---->

</article>

 <h4 class="otro">Otros articulos</h4>
 <hr>
	

<div class="arts-i">
	
	<div class="not-3">
		
		<h5>Investigaciones</h5>
		<a href="Cursos-de-introducción.html"><h3>
			Cursos de introducción a la ciberseguridad gratuitos

		</h3></a>
		<h6>
		Juan Manuel Harán <time datetime="08-06-2023"> </time>08-06-2023</h6>



	</div>
	<div class="not1-3">
		
		<h5>Investigaciones</h5>
		<a href="Malware-bancario-para-Android.html"><h3>
			Las detecciones de malware bancario para Android aumentaron 428% el último año
		</h3></a>
		<h6>
		Vladislav Hrčka <time datetime="09-06-2023"> </time>09-06-2023</h6>

	</div>
	<div class="not2-3">
		
		<h5>Investigaciones</h5>
		<a href="backdoor-SideWalk.html"><h3>
			Análisis de la variante para Linux del backdoor SideWalk
		</h3></a>
		<h6>
		Vladislav Hrčka

  <time datetime="28-06-2023"> </time>28-06-2023</h6>


	</div>


	</div>
<footer>
	<div class="grupo1">	
<div class="box">
	 	 		<img src="../img/bannerlogo-6.png">

	<h2>Contactanos</h2>
	<h3>Liquidmatrix@gmail.com </h3>	
	 		 
</div> 
<div class="sobre">
	<h2>Sobre nosotros</h2>
	<p>Somos un portal de informacion y  seguirad informatica , con el fin de dar conciencia a los usuarios , capazitar  y actualizarlos sobre nuevas tegnologias y sucesos relevantes sobre este ambito.</p> 
</div>

	 	<div class="sobre">
	 		<h2> Contactanos</h2>
	 	<div class="red-social">
	 		<a href="https://www.facebook.com/liquidmatrixdigest/"><i class="fa fa-facebook"></i></a>
		
		<a href="https://twitter.com/liquidmatrix"><i class="fa fa-twitter"></i></a>

		<a href="https://www.youtube.com/channel/UCFfZEfQF0T4O_6t6YoHGW4w"> <i class="fa fa-youtube"></i> </a>
	
	 	</div>
 </div>
 </div>

	 <div class="grupo2">
	 	<h6>&copy; 2023 Suburbio de ideas </h6>
	 	
	 	<p>Disclaimer: </p>
	 	
	 	<p>La propiedad intelectual de los sitos usados para el portafolio solo es para inspiración, los derechos de imagen pertenecen a las entidades </p>
	 </div>
</footer>



</body>
</html>